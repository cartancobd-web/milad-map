<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Admin Login</title>
<style>
body {font-family:Arial; background:#f4f4f4; padding:20px;}
.box {background:white; padding:20px; border-radius:10px; max-width:400px; margin:auto;}
input {width:100%; padding:8px; margin-bottom:10px;}
button {padding:8px; width:100%;}
.card {background:white; padding:15px; margin-top:15px; border-radius:10px;}
</style>
</head>
<body>

<div class="box">
<h2>Admin Login</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<div id="dashboard" style="display:none;">
<h2>Dashboard</h2>
<p>Total Posts: <span id="total">0</span></p>
<p>Pending: <span id="pending">0</span></p>
<p>Approved: <span id="approved">0</span></p>
<div id="posts"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAETli2UtjPzEU5xd9U6_W7xeJxBGq3xV8",
  authDomain: "milad-4727b.firebaseapp.com",
  projectId: "milad-4727b",
  appId: "1:1088600725533:web:f4bdacb68606f846590ef4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.login = async function(){

  try {
    await signInWithEmailAndPassword(auth, email.value, password.value);
    document.querySelector(".box").style.display="none";
    document.getElementById("dashboard").style.display="block";
    loadData();
  } catch(err){
    msg.innerText="Wrong Email or Password";
  }
}

async function loadData(){

  const snapshot = await getDocs(collection(db,"milads"));

  let total=0, pending=0, approved=0;
  const postsDiv=document.getElementById("posts");
  postsDiv.innerHTML="";

  snapshot.forEach((d)=>{
    const data=d.data();
    total++;

    if(data.status==="approved") approved++;
    else pending++;

    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <b>${data.mosque}</b><br>
      জেলা: ${data.district}<br>
      খাবার: ${data.food}<br>
      স্ট্যাটাস: ${data.status || "pending"}<br>
      <button onclick="approve('${d.id}')">Approve</button>
      <button onclick="removePost('${d.id}')">Delete</button>
    `;
    postsDiv.appendChild(div);
  });

  total.innerText=total;
  pending.innerText=pending;
  approved.innerText=approved;
}

window.approve = async function(id){
  await updateDoc(doc(db,"milads",id),{status:"approved"});
  loadData();
}

window.removePost = async function(id){
  await deleteDoc(doc(db,"milads",id));
  loadData();
}

</script>
</body>
</html>